<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/annenkov/ConCert" target="_balnk">Project Page</a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">SmartContracts.Circulation</h1>

<div class="code">
<span class="comment">(*&nbsp;In&nbsp;this&nbsp;file&nbsp;we&nbsp;prove&nbsp;that&nbsp;the&nbsp;circulation&nbsp;of&nbsp;any&nbsp;blockchain&nbsp;implementing&nbsp;our<br/>
semantics&nbsp;is&nbsp;as&nbsp;expected:&nbsp;the&nbsp;sum&nbsp;of&nbsp;all&nbsp;rewards&nbsp;paid&nbsp;out&nbsp;in&nbsp;blocks.&nbsp;*)</span><br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#"><span class="id" title="library">Permutation</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="library">ZArith</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.micromega.Psatz.html#"><span class="id" title="library">Psatz</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Classes.Morphisms.html#"><span class="id" title="library">Morphisms</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Automation.html#"><span class="id" title="library">Automation</span></a> <a class="idref" href="SmartContracts.Blockchain.html#"><span class="id" title="library">Blockchain</span></a> <a class="idref" href="SmartContracts.Extras.html#"><span class="id" title="library">Extras</span></a> <a class="idref" href="SmartContracts.Finite.html#"><span class="id" title="library">Finite</span></a> <a class="idref" href="SmartContracts.ChainedList.html#"><span class="id" title="library">ChainedList</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="RecordUpdate.RecordSet.html#"><span class="id" title="library">RecordSet</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a name="Circulation"><span class="id" title="section">Circulation</span></a>.<br/>
<span class="id" title="keyword">Context</span> {<span class="id" title="var">ChainBase</span> : <a class="idref" href="SmartContracts.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>}.<br/>
<span class="id" title="keyword">Context</span> `{<a class="idref" href="SmartContracts.Finite.html#Finite"><span class="id" title="class">Finite</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>}.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Definition</span> <a name="circulation"><span class="id" title="definition">circulation</span></a> (<span class="id" title="var">chain</span> : <a class="idref" href="SmartContracts.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Extras.html#sumZ"><span class="id" title="definition">sumZ</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <a class="idref" href="SmartContracts.Circulation.html#chain"><span class="id" title="variable">chain</span></a>) (<a class="idref" href="SmartContracts.Finite.html#elements"><span class="id" title="method">elements</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>).<br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;prove&nbsp;first&nbsp;that&nbsp;over&nbsp;any&nbsp;single&nbsp;action,&nbsp;the&nbsp;circulation&nbsp;is&nbsp;preserved.<br/>
The&nbsp;idea&nbsp;behind&nbsp;this&nbsp;proof&nbsp;is&nbsp;that&nbsp;addrs&nbsp;contain&nbsp;from&nbsp;and&nbsp;to&nbsp;so<br/>
we&nbsp;can&nbsp;move&nbsp;them&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;sum&nbsp;and&nbsp;it&nbsp;easily&nbsp;follows&nbsp;that<br/>
the&nbsp;sum&nbsp;of&nbsp;their&nbsp;balances&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;before.&nbsp;For&nbsp;the&nbsp;rest&nbsp;of&nbsp;the<br/>
list&nbsp;the&nbsp;total&nbsp;balance&nbsp;will&nbsp;then&nbsp;not&nbsp;be&nbsp;affected&nbsp;which&nbsp;follows&nbsp;by&nbsp;induction.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="address_reorganize"><span class="id" title="lemma">address_reorganize</span></a> {<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="SmartContracts.Circulation.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">suf</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="SmartContracts.Circulation.html#a"><span class="id" title="variable">a</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.Circulation.html#b"><span class="id" title="variable">b</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="SmartContracts.Circulation.html#suf"><span class="id" title="variable">suf</span></a>) (<a class="idref" href="SmartContracts.Finite.html#elements"><span class="id" title="method">elements</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a_neq_b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="SmartContracts.Extras.html#NoDup_incl_reorganize"><span class="id" title="lemma">NoDup_incl_reorganize</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><span class="id" title="var">a</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <span class="id" title="var">b</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#incl"><span class="id" title="definition">incl</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="eval_action_from_to_same"><span class="id" title="lemma">eval_action_from_to_same</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">pre</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">act</span> : <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">post</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">new_acts</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eval</span> : <a class="idref" href="SmartContracts.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="SmartContracts.Circulation.html#pre"><span class="id" title="variable">pre</span></a> <a class="idref" href="SmartContracts.Circulation.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="SmartContracts.Circulation.html#post"><span class="id" title="variable">post</span></a> <a class="idref" href="SmartContracts.Circulation.html#new_acts"><span class="id" title="variable">new_acts</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#eval_from"><span class="id" title="definition">eval_from</span></a> <a class="idref" href="SmartContracts.Circulation.html#eval"><span class="id" title="variable">eval</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#eval_to"><span class="id" title="definition">eval_to</span></a> <a class="idref" href="SmartContracts.Circulation.html#eval"><span class="id" title="variable">eval</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#post"><span class="id" title="variable">post</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#pre"><span class="id" title="variable">pre</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">from_eq_to</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> (<a class="idref" href="SmartContracts.Finite.html#elements"><span class="id" title="method">elements</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) <span class="id" title="keyword">as</span> [| <span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span>, (<a class="idref" href="SmartContracts.Blockchain.html#account_balance_post"><span class="id" title="lemma">account_balance_post</span></a> <span class="id" title="tactic">eval</span>), <span class="id" title="var">from_eq_to</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">eval_action_from_to_same</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="eval_action_circulation_unchanged"><span class="id" title="lemma">eval_action_circulation_unchanged</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">pre</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">act</span> : <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">post</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">new_acts</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>} :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="SmartContracts.Circulation.html#pre"><span class="id" title="variable">pre</span></a> <a class="idref" href="SmartContracts.Circulation.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="SmartContracts.Circulation.html#post"><span class="id" title="variable">post</span></a> <a class="idref" href="SmartContracts.Circulation.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#post"><span class="id" title="variable">post</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#pre"><span class="id" title="variable">pre</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">eval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#address_eqb_spec"><span class="id" title="method">address_eqb_spec</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#eval_from"><span class="id" title="definition">eval_from</span></a> <span class="id" title="tactic">eval</span>) (<a class="idref" href="SmartContracts.Blockchain.html#eval_to"><span class="id" title="definition">eval_to</span></a> <span class="id" title="tactic">eval</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">from_eq_to</span> | <span class="id" title="var">from_neq_to</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Circulation.html#address_reorganize"><span class="id" title="lemma">address_reorganize</span></a> <span class="id" title="var">from_neq_to</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">suf</span> <span class="id" title="var">perm</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#Permutation_sym"><span class="id" title="lemma">Permutation_sym</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> 2!(<a class="idref" href="SmartContracts.Extras.html#sumZ_permutation"><span class="id" title="lemma">sumZ_permutation</span></a> <span class="id" title="var">perm</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance_post_to"><span class="id" title="lemma">account_balance_post_to</span></a> <span class="id" title="tactic">eval</span> <span class="id" title="var">from_neq_to</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance_post_from"><span class="id" title="lemma">account_balance_post_from</span></a> <span class="id" title="tactic">eval</span> <span class="id" title="var">from_neq_to</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">enough</span> (<a class="idref" href="SmartContracts.Extras.html#sumZ"><span class="id" title="definition">sumZ</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <span class="id" title="var">pre</span>) <span class="id" title="var">suf</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Extras.html#sumZ"><span class="id" title="definition">sumZ</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <span class="id" title="var">post</span>) <span class="id" title="var">suf</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#Permutation_NoDup"><span class="id" title="lemma">Permutation_NoDup</span></a> <span class="id" title="var">perm</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">perm_set</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">from_not_in_suf</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#eval_from"><span class="id" title="definition">eval_from</span></a> <span class="id" title="tactic">eval</span>) <span class="id" title="var">suf</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> (<a class="idref" href="SmartContracts.Extras.html#in_NoDup_app"><span class="id" title="lemma">in_NoDup_app</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="SmartContracts.Blockchain.html#eval_from"><span class="id" title="definition">eval_from</span></a> <span class="id" title="tactic">eval</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.Blockchain.html#eval_to"><span class="id" title="definition">eval_to</span></a> <span class="id" title="tactic">eval</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a> <span class="id" title="var">_</span>); <span class="id" title="tactic">intuition</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">to_not_in_suf</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#eval_to"><span class="id" title="definition">eval_to</span></a> <span class="id" title="tactic">eval</span>) <span class="id" title="var">suf</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> (<a class="idref" href="SmartContracts.Extras.html#in_NoDup_app"><span class="id" title="lemma">in_NoDup_app</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="SmartContracts.Blockchain.html#eval_from"><span class="id" title="definition">eval_from</span></a> <span class="id" title="tactic">eval</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.Blockchain.html#eval_to"><span class="id" title="definition">eval_to</span></a> <span class="id" title="tactic">eval</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a> <span class="id" title="var">_</span>); <span class="id" title="tactic">intuition</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">perm</span> <span class="id" title="var">perm_set</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance_post_irrelevant"><span class="id" title="lemma">account_balance_post_irrelevant</span></a> <span class="id" title="tactic">eval</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">balance_irrel</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">suf</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span>, <span class="id" title="var">balance_irrel</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">eval_action_circulation_unchanged</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a name="circulation_proper"><span class="id" title="instance">circulation_proper</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#ChainEquiv"><span class="id" title="record">ChainEquiv</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#eq"><span class="id" title="inductive">eq</span></a>) <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> [].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a>, <a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> (<a class="idref" href="SmartContracts.Finite.html#elements"><span class="id" title="method">elements</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) <span class="id" title="keyword">as</span> [|<span class="id" title="var">z</span> <span class="id" title="var">zs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span>: <span class="id" title="var">_</span> |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;prove&nbsp;that&nbsp;adding&nbsp;a&nbsp;block&nbsp;_does_&nbsp;increase&nbsp;the&nbsp;circulation<br/>
by&nbsp;what&nbsp;we&nbsp;would&nbsp;expect.&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a name="circulation_add_new_block"><span class="id" title="lemma">circulation_add_new_block</span></a> <span class="id" title="var">header</span> <span class="id" title="var">env</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">add_new_block_to_env</span></a> <a class="idref" href="SmartContracts.Circulation.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="SmartContracts.Circulation.html#env"><span class="id" title="variable">env</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#env"><span class="id" title="variable">env</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> <a class="idref" href="SmartContracts.Circulation.html#header"><span class="id" title="variable">header</span></a>)%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hperm</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">suf</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <span class="id" title="var">header</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="SmartContracts.Circulation.html#suf"><span class="id" title="variable">suf</span></a>) (<a class="idref" href="SmartContracts.Finite.html#elements"><span class="id" title="method">elements</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Extras.html#NoDup_incl_reorganize"><span class="id" title="lemma">NoDup_incl_reorganize</span></a>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#incl"><span class="id" title="definition">incl</span></a>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hperm</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">suf</span> <span class="id" title="var">perm</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#Permutation_NoDup"><span class="id" title="lemma">Permutation_NoDup</span></a> <span class="id" title="var">perm</span> (<a class="idref" href="SmartContracts.Finite.html#elements_set"><span class="id" title="method">elements_set</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)) <span class="id" title="keyword">as</span> <span class="id" title="var">perm_set</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Blockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Blockchain.html#address_eq_refl"><span class="id" title="lemma">address_eq_refl</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [|- ?<span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">c</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> ?<span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">d</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> ?<span class="id" title="var">a</span>] =&gt; <span class="id" title="var">enough</span> (<span class="id" title="var">c</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">d</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="SmartContracts.Extras.html#in_NoDup_app"><span class="id" title="lemma">in_NoDup_app</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <span class="id" title="var">header</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <span class="id" title="var">header</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <span class="id" title="var">suf</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">intuition</span>) <span class="id" title="var">perm_set</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">not_in_suf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">perm</span> <span class="id" title="var">perm_set</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">suf</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Logic.Decidable.html#not_or"><span class="id" title="lemma">Decidable.not_or</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">not_in_suf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#address_eqb_spec"><span class="id" title="method">address_eqb_spec</span></a> <span class="id" title="var">x</span> (<a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <span class="id" title="var">header</span>)); <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#proj2"><span class="id" title="lemma">proj2</span></a> <span class="id" title="var">not_in_suf</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;then&nbsp;get&nbsp;a&nbsp;lemma&nbsp;over&nbsp;steps&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a name="step_circulation"><span class="id" title="lemma">step_circulation</span></a> {<span class="id" title="var">prev</span> <span class="id" title="var">next</span>} (<span class="id" title="var">step</span> : <a class="idref" href="SmartContracts.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <a class="idref" href="SmartContracts.Circulation.html#prev"><span class="id" title="variable">prev</span></a> <a class="idref" href="SmartContracts.Circulation.html#next"><span class="id" title="variable">next</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#next"><span class="id" title="variable">next</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.Circulation.html#step"><span class="id" title="variable">step</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="SmartContracts.Blockchain.html#step_block"><span class="id" title="constructor">step_block</span></a> <span class="id" title="var">header</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#prev"><span class="id" title="variable">prev</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> <span class="id" title="var">header</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#prev"><span class="id" title="variable">prev</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_chain_step</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">rewrite_environment_equiv</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;New&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Circulation.html#circulation_add_new_block"><span class="id" title="lemma">circulation_add_new_block</span></a>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;New&nbsp;action&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <a class="idref" href="SmartContracts.Circulation.html#eval_action_circulation_unchanged"><span class="id" title="lemma">eval_action_circulation_unchanged</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Permute&nbsp;queue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;And&nbsp;combining&nbsp;these&nbsp;gives&nbsp;the&nbsp;final&nbsp;result.&nbsp;*)</span><br/>
<span class="id" title="keyword">Theorem</span> <a name="chain_trace_circulation"><span class="id" title="lemma">chain_trace_circulation</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">state</span> : <a class="idref" href="SmartContracts.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">trace</span> : <a class="idref" href="SmartContracts.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="SmartContracts.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="SmartContracts.Circulation.html#state"><span class="id" title="variable">state</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a> <a class="idref" href="SmartContracts.Circulation.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Extras.html#sumZ"><span class="id" title="definition">sumZ</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#trace_blocks"><span class="id" title="definition">trace_blocks</span></a> <a class="idref" href="SmartContracts.Circulation.html#trace"><span class="id" title="variable">trace</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> <a class="idref" href="SmartContracts.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <span class="id" title="keyword">as</span> <span class="id" title="var">from</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">from</span> <span class="id" title="var">mid</span> <span class="id" title="var">to</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span> <span class="id" title="var">x</span>]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Circulation.html#circulation"><span class="id" title="definition">circulation</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> (<a class="idref" href="SmartContracts.Finite.html#elements"><span class="id" title="method">elements</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<a class="idref" href="SmartContracts.Circulation.html#step_circulation"><span class="id" title="lemma">step_circulation</span></a> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_chain_step</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IH</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="SmartContracts.Circulation.html#Circulation"><span class="id" title="section">Circulation</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
