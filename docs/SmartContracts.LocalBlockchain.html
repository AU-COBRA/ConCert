<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/annenkov/ConCert" target="_balnk">Project Page</a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">SmartContracts.LocalBlockchain</h1>

<div class="code">
<span class="comment">(*&nbsp;This&nbsp;file&nbsp;gives&nbsp;two&nbsp;different&nbsp;implementations&nbsp;of&nbsp;the&nbsp;blockchain<br/>
execution&nbsp;layer&nbsp;defined&nbsp;in&nbsp;Blockchain.v.&nbsp;Both&nbsp;versions&nbsp;are&nbsp;execution<br/>
layers&nbsp;using&nbsp;std++'s&nbsp;finite&nbsp;maps&nbsp;and&nbsp;are&nbsp;thus&nbsp;relatively<br/>
efficient.&nbsp;They&nbsp;differ&nbsp;in&nbsp;execution&nbsp;order:&nbsp;one&nbsp;uses&nbsp;a&nbsp;depth-first<br/>
execution&nbsp;order,&nbsp;while&nbsp;the&nbsp;other&nbsp;uses&nbsp;a&nbsp;breadth-first&nbsp;execution&nbsp;order.&nbsp;*)</span><br/>

<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="library">ZArith</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#"><span class="id" title="library">Permutation</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Classes.Morphisms.html#"><span class="id" title="library">Morphisms</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Serializable.html#"><span class="id" title="library">Serializable</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Monads.html#"><span class="id" title="library">Monads</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Containers.html#"><span class="id" title="library">Containers</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Extras.html#"><span class="id" title="library">Extras</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Automation.html#"><span class="id" title="library">Automation</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.BoundedN.html#"><span class="id" title="library">BoundedN</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.Circulation.html#"><span class="id" title="library">Circulation</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">SmartContracts</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="SmartContracts.ChainedList.html#"><span class="id" title="library">ChainedList</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">RecordUpdate</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="RecordUpdate.RecordUpdate.html#"><span class="id" title="library">RecordUpdate</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.micromega.Psatz.html#"><span class="id" title="library">Psatz</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">stdpp</span> <span class="id" title="keyword">Require</span> <span class="id" title="library">countable</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a name="LocalBlockchain"><span class="id" title="section">LocalBlockchain</span></a>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bool</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="AddrSize"><span class="id" title="definition">AddrSize</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> := 2<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.NArith.BinNat.html#7878de73cb557151570f9fd311801cb8"><span class="id" title="notation">^</span></a>128.<br/>
<span class="id" title="keyword">Definition</span> <a name="ContractAddrBase"><span class="id" title="definition">ContractAddrBase</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> := <a class="idref" href="SmartContracts.LocalBlockchain.html#AddrSize"><span class="id" title="definition">AddrSize</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> 2.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="LocalChainBase"><span class="id" title="instance">LocalChainBase</span></a> : <a class="idref" href="SmartContracts.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">Address</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">BoundedN</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">AddrSize</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">address_eqb</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">BoundedN.eqb</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">address_eqb_spec</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">BoundedN.eqb_spec</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">address_is_contract</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">ContractAddrBase</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">&lt;=?</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">BoundedN.to_N</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">a</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">)%</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_chain_base"><span class="id" title="constructor">N</span></a><br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">Record</span> <a name="LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;<a name="build_local_chain"><span class="id" title="constructor">build_local_chain</span></a> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lc_height"><span class="id" title="projection">lc_height</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lc_slot"><span class="id" title="projection">lc_slot</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lc_fin_height"><span class="id" title="projection">lc_fin_height</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lc_account_balances"><span class="id" title="projection">lc_account_balances</span></a> : <a class="idref" href="SmartContracts.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lc_contract_state"><span class="id" title="projection">lc_contract_state</span></a> : <a class="idref" href="SmartContracts.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="SmartContracts.Serializable.html#SerializedValue"><span class="id" title="record">SerializedValue</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lc_contracts"><span class="id" title="projection">lc_contracts</span></a> : <a class="idref" href="SmartContracts.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="SmartContracts.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a name="local_chain_settable"><span class="id" title="instance">local_chain_settable</span></a> : <a class="idref" href="RecordUpdate.RecordSet.html#Settable"><span class="id" title="class">Settable</span></a> <span class="id" title="var">_</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">settable</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">!</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">build_local_chain</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">&lt;</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_height"><span class="id" title="projection">lc_height</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_slot"><span class="id" title="projection">lc_slot</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_fin_height"><span class="id" title="projection">lc_fin_height</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#lc_account_balances"><span class="id" title="projection">lc_account_balances</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contract_state"><span class="id" title="projection">lc_contract_state</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contracts"><span class="id" title="projection">lc_contracts</span></a><a class="idref" href="RecordUpdate.RecordSet.html#5e40a7b65bc4aadecaca2fe3665ba66f"><span class="id" title="notation">&gt;</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="lc_to_env"><span class="id" title="definition">lc_to_env</span></a> (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">env_chain</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">{|</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">chain_height</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc_height</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">current_slot</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc_slot</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">finalized_height</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc_fin_height</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">account_balance</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">with_default</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">0%</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">Z</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">FMap.find</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc_account_balances</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">));</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">|};</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">env_contract_states</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">FMap.find</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc_contract_state</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">env_contracts</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">FMap.find</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">a</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc_contracts</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_env"><span class="id" title="constructor">);</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Global</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_to_env"><span class="id" title="definition">Coercion</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_to_env"><span class="id" title="definition">lc_to_env</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_to_env"><span class="id" title="definition">:</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_to_env"><span class="id" title="definition">LocalChain</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_to_env"><span class="id" title="definition">&gt;-&gt;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_to_env"><span class="id" title="definition">Environment</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a name="LocalBlockchain.ExecuteActions"><span class="id" title="section">ExecuteActions</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="add_balance"><span class="id" title="definition">add_balance</span></a> (<span class="id" title="var">addr</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<span class="id" title="var">amt</span> : <a class="idref" href="SmartContracts.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> <span class="id" title="var">opt</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="SmartContracts.LocalBlockchain.html#amt"><span class="id" title="variable">amt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="SmartContracts.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 <a class="idref" href="SmartContracts.LocalBlockchain.html#opt"><span class="id" title="variable">opt</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_account_balances"><span class="id" title="projection">lc_account_balances</span></a> <a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">::=</span></a> <a class="idref" href="SmartContracts.Containers.html#FMap.partial_alter"><span class="id" title="abbreviation">FMap.partial_alter</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#update"><span class="id" title="variable">update</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a><a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">|&gt;</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="transfer_balance"><span class="id" title="definition">transfer_balance</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">from</span> <span class="id" title="var">to</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<span class="id" title="var">amount</span> : <a class="idref" href="SmartContracts.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> (<a class="idref" href="SmartContracts.LocalBlockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#84c6e304dcb36f79add2a7dcc558eca1"><span class="id" title="notation">-</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a>) <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_new_contract_addr"><span class="id" title="definition">get_new_contract_addr</span></a> (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.BoundedN.html#BoundedN.of_N"><span class="id" title="definition">BoundedN.of_N</span></a> (<a class="idref" href="SmartContracts.LocalBlockchain.html#ContractAddrBase"><span class="id" title="definition">ContractAddrBase</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.NArith.BinNat.html#N.of_nat"><span class="id" title="definition">N.of_nat</span></a> (<a class="idref" href="SmartContracts.Containers.html#FMap.size"><span class="id" title="abbreviation">FMap.size</span></a> (<a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contracts"><span class="id" title="projection">lc_contracts</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="add_contract"><span class="id" title="definition">add_contract</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">addr</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">wc</span> : <a class="idref" href="SmartContracts.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contracts"><span class="id" title="projection">lc_contracts</span></a> <a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">::=</span></a> <a class="idref" href="SmartContracts.Containers.html#FMap.add"><span class="id" title="abbreviation">FMap.add</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a><a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">|&gt;</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="set_contract_state"><span class="id" title="definition">set_contract_state</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">addr</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="SmartContracts.Serializable.html#SerializedValue"><span class="id" title="record">SerializedValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contract_state"><span class="id" title="projection">lc_contract_state</span></a> <a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">::=</span></a> <a class="idref" href="SmartContracts.Containers.html#FMap.add"><span class="id" title="abbreviation">FMap.add</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="RecordUpdate.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">|&gt;</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="send_or_call"><span class="id" title="definition">send_or_call</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">from</span> <span class="id" title="var">to</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="SmartContracts.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">msg</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="SmartContracts.Serializable.html#SerializedValue"><span class="id" title="record">SerializedValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#f1746f02f141d025b1e53605943919bf"><span class="id" title="notation">&lt;?</span></a> 0 <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> <a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>.(<a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contracts"><span class="id" title="projection">lc_contracts</span></a>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Fail&nbsp;if&nbsp;sending&nbsp;a&nbsp;message&nbsp;to&nbsp;address&nbsp;without&nbsp;contract&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#msg"><span class="id" title="variable">msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">msg</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">wc</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">state</span> <a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="SmartContracts.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a><a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">ctx</span> := <a class="idref" href="SmartContracts.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">do</span></a> <a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">new_state</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">new_actions</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="SmartContracts.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <span class="id" title="var">wc</span>  <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#msg"><span class="id" title="variable">msg</span></a><a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a>) <a class="idref" href="SmartContracts.LocalBlockchain.html#new_actions"><span class="id" title="variable">new_actions</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="deploy_contract"><span class="id" title="definition">deploy_contract</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">from</span> : <a class="idref" href="SmartContracts.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="SmartContracts.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">wc</span> : <a class="idref" href="SmartContracts.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">setup</span> : <a class="idref" href="SmartContracts.Serializable.html#SerializedValue"><span class="id" title="record">SerializedValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#f1746f02f141d025b1e53605943919bf"><span class="id" title="notation">&lt;?</span></a> 0 <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <span class="id" title="keyword">if</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> <a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">contract_addr</span> <a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#get_new_contract_addr"><span class="id" title="definition">get_new_contract_addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#contract_addr"><span class="id" title="variable">contract_addr</span></a> (<a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contracts"><span class="id" title="projection">lc_contracts</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#contract_addr"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">ctx</span> := <a class="idref" href="SmartContracts.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#contract_addr"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">state</span> <a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="SmartContracts.Blockchain.html#wc_init"><span class="id" title="definition">wc_init</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="SmartContracts.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#add_contract"><span class="id" title="definition">add_contract</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#contract_addr"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#contract_addr"><span class="id" title="variable">contract_addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">nat</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="execute_action"><span class="id" title="definition">execute_action</span></a> (<span class="id" title="var">act</span> : <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>) (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="SmartContracts.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <span class="id" title="var">from</span> (<a class="idref" href="SmartContracts.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#send_or_call"><span class="id" title="definition">send_or_call</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="SmartContracts.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <span class="id" title="var">from</span> (<a class="idref" href="SmartContracts.Blockchain.html#act_deploy"><span class="id" title="constructor">act_deploy</span></a> <span class="id" title="var">amount</span> <span class="id" title="var">wc</span> <span class="id" title="var">setup</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#deploy_contract"><span class="id" title="definition">deploy_contract</span></a> <span class="id" title="var">from</span> <span class="id" title="var">amount</span> <span class="id" title="var">wc</span> <span class="id" title="var">setup</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="SmartContracts.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <span class="id" title="var">from</span> (<a class="idref" href="SmartContracts.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">msg</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#send_or_call"><span class="id" title="definition">send_or_call</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">msg</span>) <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a name="execute_actions"><span class="id" title="definition">execute_actions</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">count</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">acts</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">depth_first</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#count"><span class="id" title="variable">count</span></a>, <a class="idref" href="SmartContracts.LocalBlockchain.html#acts"><span class="id" title="variable">acts</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0, <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">count</span>, <span class="id" title="var">act</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <span class="id" title="var">acts</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">do</span></a> <a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">next_acts</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">lc</span><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#execute_action"><span class="id" title="definition">execute_action</span></a> <span class="id" title="var">act</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="SmartContracts.Monads.html#4842b7321410137459b4dcd7c5f317e4"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">acts</span> := <span class="id" title="keyword">if</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#depth_first"><span class="id" title="variable">depth_first</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#next_acts"><span class="id" title="variable">next_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#acts"><span class="id" title="variable">acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#acts"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#next_acts"><span class="id" title="variable">next_acts</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#execute_actions"><span class="id" title="definition">execute_actions</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#count"><span class="id" title="variable">count</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#acts"><span class="id" title="variable">acts</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#depth_first"><span class="id" title="variable">depth_first</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="transfer_balance_equiv"><span class="id" title="lemma">transfer_balance_equiv</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) (<span class="id" title="var">env</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Blockchain.html#transfer_balance"><span class="id" title="definition">Blockchain.transfer_balance</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_env_equiv"><span class="id" title="constructor">build_env_equiv</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_equiv"><span class="id" title="constructor">build_chain_equiv</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Blockchain.html#add_balance"><span class="id" title="definition">Blockchain.add_balance</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">addr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_partial_alter"><span class="id" title="lemma">FMap.find_partial_alter</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_partial_alter_ne"><span class="id" title="lemma">FMap.find_partial_alter_ne</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>); <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="set_contract_state_equiv"><span class="id" title="lemma">set_contract_state_equiv</span></a> <span class="id" title="var">addr</span> <span class="id" title="var">state</span> (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) (<span class="id" title="var">env</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.LocalBlockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Blockchain.html#set_contract_state"><span class="id" title="definition">Blockchain.set_contract_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_env_equiv"><span class="id" title="constructor">build_env_equiv</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_equiv"><span class="id" title="constructor">build_chain_equiv</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">addr'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Blockchain.html#set_chain_contract_state"><span class="id" title="definition">set_chain_contract_state</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="add_contract_equiv"><span class="id" title="lemma">add_contract_equiv</span></a> <span class="id" title="var">addr</span> <span class="id" title="var">wc</span> (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) (<span class="id" title="var">env</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.LocalBlockchain.html#add_contract"><span class="id" title="definition">add_contract</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Blockchain.html#add_contract"><span class="id" title="definition">Blockchain.add_contract</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_env_equiv"><span class="id" title="constructor">build_env_equiv</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_equiv"><span class="id" title="constructor">build_chain_equiv</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">addr'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="gtb_le"><span class="id" title="lemma">gtb_le</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#y"><span class="id" title="variable">y</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.gtb_ltb"><span class="id" title="lemma">Z.gtb_ltb</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.ltb_ge"><span class="id" title="lemma">Z.ltb_ge</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="ltb_ge"><span class="id" title="lemma">ltb_ge</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#f1746f02f141d025b1e53605943919bf"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#y"><span class="id" title="variable">y</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.ltb_ge"><span class="id" title="lemma">Z.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="send_or_call_step"><span class="id" title="lemma">send_or_call_step</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">msg</span> <span class="id" title="var">act</span> <span class="id" title="var">lc_before</span> <span class="id" title="var">new_acts</span> <span class="id" title="var">lc_after</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#send_or_call"><span class="id" title="definition">send_or_call</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#msg"><span class="id" title="variable">msg</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_before"><span class="id" title="variable">lc_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_after"><span class="id" title="variable">lc_after</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> (<span class="id" title="keyword">match</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#msg"><span class="id" title="variable">msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="SmartContracts.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">msg</span> =&gt; <a class="idref" href="SmartContracts.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#msg"><span class="id" title="variable">msg</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_before"><span class="id" title="variable">lc_before</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_after"><span class="id" title="variable">lc_after</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#new_acts"><span class="id" title="variable">new_acts</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">sent</span> <span class="id" title="var">act_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#send_or_call"><span class="id" title="definition">send_or_call</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">sent</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.ltb"><span class="id" title="definition">Z.ltb</span></a> <span class="id" title="var">amount</span> 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_nonnegative</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.gtb"><span class="id" title="definition">Z.gtb</span></a> <span class="id" title="var">amount</span> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <span class="id" title="var">lc_before</span> <span class="id" title="var">from</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">balance_enough</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <span class="id" title="var">to</span> (<a class="idref" href="SmartContracts.LocalBlockchain.html#lc_contracts"><span class="id" title="projection">lc_contracts</span></a> <span class="id" title="var">lc_before</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">wc</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">to_contract</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;there&nbsp;is&nbsp;a&nbsp;contract&nbsp;at&nbsp;destination,&nbsp;so&nbsp;do&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">prev_state</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">prev_state_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">lc_to_env</span>] <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <span class="id" title="var">wc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [[<span class="id" title="var">new_state</span> <span class="id" title="var">resp_acts</span>]|] <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">gtb_le</span> <span class="id" title="var">ltb_ge</span> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="SmartContracts.Blockchain.html#eval_call"><span class="id" title="constructor">eval_call</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">wc</span> <span class="id" title="var">msg</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">resp_acts</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">receive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#wc_receive_proper"><span class="id" title="instance">wc_receive_proper</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance_equiv"><span class="id" title="lemma">transfer_balance_equiv</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">sent</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#set_contract_state_equiv"><span class="id" title="lemma">set_contract_state_equiv</span></a>, <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance_equiv"><span class="id" title="lemma">transfer_balance_equiv</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;no&nbsp;contract&nbsp;at&nbsp;destination,&nbsp;so&nbsp;msg&nbsp;should&nbsp;be&nbsp;empty&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <span class="id" title="var">to</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">addr_format</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">new_acts</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">new_acts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="SmartContracts.Blockchain.html#eval_transfer"><span class="id" title="constructor">eval_transfer</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">sent</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance_equiv"><span class="id" title="lemma">transfer_balance_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="get_new_contract_addr_is_contract_addr"><span class="id" title="lemma">get_new_contract_addr_is_contract_addr</span></a> <span class="id" title="var">lc</span> <span class="id" title="var">addr</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#get_new_contract_addr"><span class="id" title="definition">get_new_contract_addr</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">get</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#get_new_contract_addr"><span class="id" title="definition">get_new_contract_addr</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">get</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="SmartContracts.BoundedN.html#BoundedN.of_N_some"><span class="id" title="lemma">BoundedN.of_N_some</span></a> <span class="id" title="var">get</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">addr</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">addr</span> <span class="id" title="var">prf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id" title="keyword">context</span>[<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.NArith.BinNat.html#N.leb"><span class="id" title="definition">N.leb</span></a> ?<span class="id" title="var">a</span> ?<span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>]] =&gt; <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.NArith.BinNat.html#N.leb_spec"><span class="id" title="lemma">N.leb_spec</span></a> <span class="id" title="var">a</span> <span class="id" title="var">b</span>); <span class="id" title="tactic">auto</span>; <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="deploy_contract_step"><span class="id" title="lemma">deploy_contract_step</span></a> <span class="id" title="var">from</span> <span class="id" title="var">amount</span> <span class="id" title="var">wc</span> <span class="id" title="var">setup</span> <span class="id" title="var">act</span> <span class="id" title="var">lc_before</span> <span class="id" title="var">new_acts</span> <span class="id" title="var">lc_after</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#deploy_contract"><span class="id" title="definition">deploy_contract</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_before"><span class="id" title="variable">lc_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_after"><span class="id" title="variable">lc_after</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#act_deploy"><span class="id" title="constructor">act_deploy</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#wc"><span class="id" title="variable">wc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#setup"><span class="id" title="variable">setup</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_before"><span class="id" title="variable">lc_before</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_after"><span class="id" title="variable">lc_after</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#new_acts"><span class="id" title="variable">new_acts</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">dep</span> <span class="id" title="var">act_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#deploy_contract"><span class="id" title="definition">deploy_contract</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">dep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.ltb"><span class="id" title="definition">Z.ltb</span></a> <span class="id" title="var">amount</span> 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_nonnegative</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.gtb"><span class="id" title="definition">Z.gtb</span></a> <span class="id" title="var">amount</span> (<a class="idref" href="SmartContracts.Blockchain.html#account_balance"><span class="id" title="projection">account_balance</span></a> <span class="id" title="var">lc_before</span> <span class="id" title="var">from</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">balance_enough</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.LocalBlockchain.html#get_new_contract_addr"><span class="id" title="definition">get_new_contract_addr</span></a> <span class="id" title="var">lc_before</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">contract_addr</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">new_contract_addr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">incoming_txs</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">dep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">no_contracts</span>; [<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#wc_init"><span class="id" title="definition">wc_init</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">state</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">recv</span>; [|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">dep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">new_acts</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">new_acts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">get_new_contract_addr_is_contract_addr</span> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="SmartContracts.Blockchain.html#eval_deploy"><span class="id" title="constructor">eval_deploy</span></a> <span class="id" title="var">from</span> <span class="id" title="var">contract_addr</span> <span class="id" title="var">amount</span> <span class="id" title="var">wc</span> <span class="id" title="var">setup</span> <span class="id" title="var">state</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">recv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#wc_init_proper"><span class="id" title="instance">wc_init_proper</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance_equiv"><span class="id" title="lemma">transfer_balance_equiv</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">dep</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">lc_after</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#set_contract_state_equiv"><span class="id" title="lemma">set_contract_state_equiv</span></a>, <a class="idref" href="SmartContracts.LocalBlockchain.html#add_contract_equiv"><span class="id" title="lemma">add_contract_equiv</span></a>, <a class="idref" href="SmartContracts.LocalBlockchain.html#transfer_balance_equiv"><span class="id" title="lemma">transfer_balance_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="execute_action_step"><span class="id" title="lemma">execute_action_step</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">act</span> : <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">new_acts</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc_before</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lc_after</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#execute_action"><span class="id" title="definition">execute_action</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_before"><span class="id" title="variable">lc_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_after"><span class="id" title="variable">lc_after</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_before"><span class="id" title="variable">lc_before</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_after"><span class="id" title="variable">lc_after</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#new_acts"><span class="id" title="variable">new_acts</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#execute_action"><span class="id" title="definition">execute_action</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">exec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">act</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">from</span> <span class="id" title="var">body</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">send_or_call_step</span> <span class="id" title="var">deploy_contract_step</span> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">body</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">to</span> <span class="id" title="var">amount</span>|<span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">msg</span>|<span class="id" title="var">amount</span> <span class="id" title="var">wc</span> <span class="id" title="var">setup</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="execute_actions_trace"><span class="id" title="lemma">execute_actions_trace</span></a> <span class="id" title="var">count</span> <span class="id" title="var">acts</span> (<span class="id" title="var">lc</span> <span class="id" title="var">lc_final</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) <span class="id" title="var">df</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">trace</span> : <a class="idref" href="SmartContracts.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="SmartContracts.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#build_chain_state"><span class="id" title="constructor">build_chain_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#acts"><span class="id" title="variable">acts</span></a>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#execute_actions"><span class="id" title="definition">execute_actions</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#count"><span class="id" title="variable">count</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#acts"><span class="id" title="variable">acts</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#df"><span class="id" title="variable">df</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_final"><span class="id" title="variable">lc_final</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="SmartContracts.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#build_chain_state"><span class="id" title="constructor">build_chain_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc_final"><span class="id" title="variable">lc_final</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">acts</span> <span class="id" title="var">lc</span> <span class="id" title="var">lc_final</span> <span class="id" title="var">trace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">count</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">count</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">acts</span> <span class="id" title="var">lc</span> <span class="id" title="var">lc_final</span> <span class="id" title="var">trace</span> <span class="id" title="var">exec</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">acts</span>; <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">acts</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">xs</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.LocalBlockchain.html#execute_action"><span class="id" title="definition">execute_action</span></a> <span class="id" title="var">x</span> <span class="id" title="var">lc</span>) <span class="id" title="keyword">as</span> [[<span class="id" title="var">new_acts</span> <span class="id" title="var">lc_after</span>]|] <span class="id" title="var">eqn</span>:<span class="id" title="var">exec_once</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">step</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#execute_action_step"><span class="id" title="lemma">execute_action_step</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">exec_once</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#ChainedList"><span class="id" title="inductive">ChainedList</span></a> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Unfold</span> <a class="idref" href="SmartContracts.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">IH</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">exec</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">df</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;depth-first&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;breadth-first&nbsp;case.&nbsp;Insert&nbsp;permute&nbsp;step.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> (<span class="id" title="var">new_acts</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">xs</span>) (<span class="id" title="var">xs</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">new_acts</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">perm_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">cut</span> (<a class="idref" href="SmartContracts.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Blockchain.html#build_chain_state"><span class="id" title="constructor">build_chain_state</span></a> <span class="id" title="var">lc_after</span> (<span class="id" title="var">new_acts</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">xs</span>))); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalBlockchain.ExecuteActions"><span class="id" title="section">ExecuteActions</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="lc_initial"><span class="id" title="definition">lc_initial</span></a> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">lc_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">0;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">lc_slot</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">0;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">lc_fin_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">0;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">lc_account_balances</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">FMap.empty</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">lc_contract_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">FMap.empty</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">lc_contracts</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">FMap.empty</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain"><span class="id" title="constructor">;</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Record</span> <a name="LocalChainBuilder"><span class="id" title="record">LocalChainBuilder</span></a> :=<br/>
&nbsp;&nbsp;<a name="build_local_chain_builder"><span class="id" title="constructor">build_local_chain_builder</span></a> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lcb_lc"><span class="id" title="projection">lcb_lc</span></a> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="lcb_trace"><span class="id" title="projection">lcb_trace</span></a> : <a class="idref" href="SmartContracts.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="SmartContracts.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#build_chain_state"><span class="id" title="constructor">build_chain_state</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lcb_lc"><span class="id" title="method">lcb_lc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>);<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="lcb_initial"><span class="id" title="definition">lcb_initial</span></a> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChainBuilder"><span class="id" title="record">LocalChainBuilder</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">lcb_lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">lc_initial</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">lcb_trace</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">clnil</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="validate_header"><span class="id" title="definition">validate_header</span></a> (<span class="id" title="var">header</span> : <a class="idref" href="SmartContracts.Blockchain.html#BlockHeader"><span class="id" title="record">BlockHeader</span></a>) (<span class="id" title="var">chain</span> : <a class="idref" href="SmartContracts.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#block_height"><span class="id" title="projection">block_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#ad2ec4e405f68c46c0a176e3e94ae2e3"><span class="id" title="notation">=?</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#chain_height"><span class="id" title="projection">chain_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#chain"><span class="id" title="variable">chain</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_slot"><span class="id" title="projection">block_slot</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#finalized_height"><span class="id" title="projection">finalized_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_finalized_height"><span class="id" title="projection">block_finalized_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="SmartContracts.Blockchain.html#block_finalized_height"><span class="id" title="projection">block_finalized_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#6b7621b45fff0af5e2b2cbb2bc2d4e1d"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_height"><span class="id" title="projection">block_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#a1c27bbd9f48118f287c317de583e02e"><span class="id" title="notation">&gt;=?</span></a> 0)%<span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="validate_header_valid"><span class="id" title="lemma">validate_header_valid</span></a> <span class="id" title="var">header</span> <span class="id" title="var">chain</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#validate_header"><span class="id" title="definition">validate_header</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#IsValidNextBlock"><span class="id" title="record">IsValidNextBlock</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#chain"><span class="id" title="variable">chain</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#validate_header"><span class="id" title="definition">validate_header</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span>: <span class="id" title="keyword">context</span>[<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb"><span class="id" title="definition">Nat.eqb</span></a> ?<span class="id" title="var">a</span> ?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#Nat.eqb_spec"><span class="id" title="lemma">Nat.eqb_spec</span></a> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span>: <span class="id" title="keyword">context</span>[<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb"><span class="id" title="definition">Nat.ltb</span></a> ?<span class="id" title="var">a</span> ?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_spec"><span class="id" title="lemma">Nat.ltb_spec</span></a> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span>: <span class="id" title="keyword">context</span>[<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#Nat.leb"><span class="id" title="definition">Nat.leb</span></a> ?<span class="id" title="var">a</span> ?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Arith.PeanoNat.html#Nat.leb_spec"><span class="id" title="lemma">Nat.leb_spec</span></a> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span>: <span class="id" title="keyword">context</span>[<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.geb"><span class="id" title="definition">Z.geb</span></a> ?<span class="id" title="var">a</span> ?<span class="id" title="var">b</span>] |- <span class="id" title="var">_</span>] =&gt; <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.ZArith.BinInt.html#Z.geb_spec"><span class="id" title="lemma">Z.geb_spec</span></a> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>; [|<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Bool.Bool.html#andb_false_r"><span class="id" title="lemma">Bool.andb_false_r</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">valid</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">valid</span>; <span class="id" title="tactic">congruence</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <span class="id" title="var">header</span>))) <span class="id" title="var">eqn</span>:<span class="id" title="var">to_acc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">valid</span>; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Bool.Bool.html#negb_true_iff"><span class="id" title="lemma">Bool.negb_true_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">to_acc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_is_valid_next_block"><span class="id" title="constructor">build_is_valid_next_block</span></a>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="validate_actions"><span class="id" title="definition">validate_actions</span></a> (<span class="id" title="var">actions</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#existsb"><span class="id" title="definition">existsb</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">act</span> =&gt; <a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#act"><span class="id" title="variable">act</span></a>)) <a class="idref" href="SmartContracts.LocalBlockchain.html#actions"><span class="id" title="variable">actions</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="validate_actions_valid"><span class="id" title="lemma">validate_actions_valid</span></a> <span class="id" title="var">actions</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#validate_actions"><span class="id" title="definition">validate_actions</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#actions"><span class="id" title="variable">actions</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="SmartContracts.Blockchain.html#act_is_from_account"><span class="id" title="definition">act_is_from_account</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#actions"><span class="id" title="variable">actions</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">actions</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#validate_actions"><span class="id" title="definition">validate_actions</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">address_is_contract</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">eq1</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Lists.List.html#existsb"><span class="id" title="definition">existsb</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">eq2</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">valid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#validate_actions"><span class="id" title="definition">validate_actions</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="add_new_block"><span class="id" title="definition">add_new_block</span></a> (<span class="id" title="var">header</span> : <a class="idref" href="SmartContracts.Blockchain.html#BlockHeader"><span class="id" title="record">BlockHeader</span></a>) (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> (<a class="idref" href="SmartContracts.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a>) (<a class="idref" href="SmartContracts.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a>) <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_height"><span class="id" title="projection">lc_height</span></a> <a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_height"><span class="id" title="projection">block_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a><a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_slot"><span class="id" title="projection">lc_slot</span></a> <a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_slot"><span class="id" title="projection">block_slot</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a><a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#lc_fin_height"><span class="id" title="projection">lc_fin_height</span></a> <a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#block_finalized_height"><span class="id" title="projection">block_finalized_height</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a><a class="idref" href="RecordUpdate.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="add_new_block_equiv"><span class="id" title="lemma">add_new_block_equiv</span></a> <span class="id" title="var">header</span> (<span class="id" title="var">lc</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChain"><span class="id" title="record">LocalChain</span></a>) (<span class="id" title="var">env</span> : <a class="idref" href="SmartContracts.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.LocalBlockchain.html#add_new_block"><span class="id" title="definition">add_new_block</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="SmartContracts.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">Blockchain.add_new_block_to_env</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#header"><span class="id" title="variable">header</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#env"><span class="id" title="variable">env</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_env_equiv"><span class="id" title="constructor">build_env_equiv</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.Blockchain.html#build_chain_equiv"><span class="id" title="constructor">build_chain_equiv</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">eq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">addr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="SmartContracts.Blockchain.html#add_balance"><span class="id" title="definition">Blockchain.add_balance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_partial_alter"><span class="id" title="lemma">FMap.find_partial_alter</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="SmartContracts.Containers.html#FMap.find_partial_alter_ne"><span class="id" title="lemma">FMap.find_partial_alter_ne</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Adds&nbsp;a&nbsp;block&nbsp;to&nbsp;the&nbsp;chain&nbsp;by&nbsp;executing&nbsp;the&nbsp;specified&nbsp;chain&nbsp;actions.<br/>
&nbsp;&nbsp;&nbsp;Returns&nbsp;the&nbsp;new&nbsp;chain&nbsp;if&nbsp;the&nbsp;execution&nbsp;succeeded&nbsp;(for&nbsp;instance,<br/>
&nbsp;&nbsp;&nbsp;transactions&nbsp;need&nbsp;enough&nbsp;funds,&nbsp;contracts&nbsp;should&nbsp;not&nbsp;reject,&nbsp;etc.&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a name="add_block"><span class="id" title="definition">add_block</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">depth_first</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">lcb</span> : <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChainBuilder"><span class="id" title="record">LocalChainBuilder</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">header</span> : <a class="idref" href="SmartContracts.Blockchain.html#BlockHeader"><span class="id" title="record">BlockHeader</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">actions</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="SmartContracts.Blockchain.html#Action"><span class="id" title="record">Action</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalChainBuilder"><span class="id" title="record">LocalChainBuilder</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">lcopt</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#lcb_lc"><span class="id" title="projection">lcb_lc</span></a> <span class="id" title="var">lcb</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#validate_header"><span class="id" title="definition">validate_header</span></a> <span class="id" title="var">header</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">do</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#validate_actions"><span class="id" title="definition">validate_actions</span></a> <span class="id" title="var">actions</span><a class="idref" href="SmartContracts.Monads.html#1b55d007168a63acd20468b65fc05f35"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">lc</span> := <a class="idref" href="SmartContracts.LocalBlockchain.html#add_new_block"><span class="id" title="definition">add_new_block</span></a> <span class="id" title="var">header</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.LocalBlockchain.html#execute_actions"><span class="id" title="definition">execute_actions</span></a> 1000 <span class="id" title="var">actions</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#lc"><span class="id" title="variable">lc</span></a> <span class="id" title="var">depth_first</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">lcopt</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">lc</span>|] <span class="id" title="var">eqn</span>:<span class="id" title="var">exec</span>; [|<span class="id" title="tactic">exact</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">lcopt</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">execute_actions</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">exec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.LocalBlockchain.html#validate_header"><span class="id" title="definition">validate_header</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">validate</span>; [|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="SmartContracts.LocalBlockchain.html#validate_actions"><span class="id" title="definition">validate_actions</span></a> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">validate_actions</span>; [|<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">congruence</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_units</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">lcb</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">prev_lc_end</span> <span class="id" title="var">prev_lcb_trace</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.9.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> {| <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">lcb_lc</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">lc</span></a><a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">;</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">lcb_trace</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.LocalBlockchain.html#build_local_chain_builder"><span class="id" title="constructor">_</span></a> |}).<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">execute_actions</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">exec</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<a class="idref" href="SmartContracts.LocalBlockchain.html#execute_actions_trace"><span class="id" title="lemma">execute_actions_trace</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">exec</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<a class="idref" href="SmartContracts.ChainedList.html#snoc"><span class="id" title="constructor">snoc</span></a> <span class="id" title="var">prev_lcb_trace</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">validate_header_valid</span> <span class="id" title="var">validate_actions_valid</span> : <span class="id" title="var">core</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="SmartContracts.Blockchain.html#step_block"><span class="id" title="constructor">step_block</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#add_new_block_equiv"><span class="id" title="lemma">add_new_block_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="LocalChainBuilderDepthFirst"><span class="id" title="instance">LocalChainBuilderDepthFirst</span></a> : <a class="idref" href="SmartContracts.Blockchain.html#ChainBuilderType"><span class="id" title="class">ChainBuilderType</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_type</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">LocalChainBuilder</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_initial</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb_initial</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_env</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb_lc</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_add_block</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">add_block</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">true</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_trace</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb_trace</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a> |}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="LocalChainBuilderBreadthFirst"><span class="id" title="definition">LocalChainBuilderBreadthFirst</span></a> : <a class="idref" href="SmartContracts.Blockchain.html#ChainBuilderType"><span class="id" title="class">ChainBuilderType</span></a> :=<br/>
&nbsp;&nbsp;{| <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_type</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">LocalChainBuilder</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_initial</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb_initial</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_env</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb_lc</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_add_block</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">add_block</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">false</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">builder_trace</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">:=</span></a> <a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">lcb_trace</span></a><a class="idref" href="SmartContracts.Blockchain.html#build_builder"><span class="id" title="constructor">;</span></a> |}.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="SmartContracts.LocalBlockchain.html#LocalBlockchain"><span class="id" title="section">LocalBlockchain</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
